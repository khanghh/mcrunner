syntax = "proto3";

option go_package = "github.com/khang/mcrunner/internal/gen;gen";


enum MessageType {
  // System message types
  UNKNOWN = 0;
  ERROR = 1;

  // pty related message types
  PTY_INPUT = 101;
  PTY_OUTPUT = 102;
  PTY_RESIZE = 103;

  // server action message types
  SERVER_STATE = 200;
  SERVER_START = 201;
  SERVER_STOP = 202;
  SERVER_KILL = 203;
}

enum ServerStatus {
  STOPPED = 1;
  RUNNING = 2;
  STOPPING = 3;
}

message Message {
  MessageType type = 1;
  oneof payload {
    ErrorInfo error = 2;
    PtyBuffer pty_buffer = 3;
    PtyResize pty_resize = 4;
    ServerState server_state = 5;
  }
}

message PtyBuffer {
  bytes data = 1;
}

message PtyResize {
  uint32 cols = 1;
  uint32 rows = 2;
}

message ServerState {
  ServerStatus status = 1;
  float tps = 2;
  int32 pid = 3;
  int64 memory_usage = 4;
  int64 memory_limit = 5;
  double cpu_usage = 6;
  double cpu_limit = 7;
  int64 uptime_sec = 8;
}

message ErrorInfo {
  string code    = 1;
  string message = 2;
}
